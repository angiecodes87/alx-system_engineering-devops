#!/bin/bash

# Check if the script is running in Docker
if [ -f /proc/1/cgroup ] && grep -q docker /proc/1/cgroup; then
    HOSTS_FILE="/etc/hosts.docker"
else
    HOSTS_FILE="/etc/hosts"
fi

# Check if the script is running with sudo
if [ "$EUID" -ne 0 ]; then
    echo "Please run this script with sudo."
    exit 1
fi

# Update the hosts file
if grep -q "localhost" "$HOSTS_FILE"; then
    sed -i 's/^127\.0\.0\.1[[:space:]]localhost$/127.0.0.2 localhost/' "$HOSTS_FILE"
else
    echo "127.0.0.2 localhost" >> "$HOSTS_FILE"
fi

if grep -q "facebook.com" "$HOSTS_FILE"; then
    sed -i 's/^.*facebook\.com.*$/8.8.8.8 facebook.com/' "$HOSTS_FILE"
else
    echo "8.8.8.8 facebook.com" >> "$HOSTS_FILE"
fi

# Print success message
echo "Hosts file updated successfully."

# Flush DNS cache
if [ -x "$(command -v systemctl)" ]; then
    systemctl restart systemd-resolved
else
    service networking restart
fi

# Exit the script
exit 0
